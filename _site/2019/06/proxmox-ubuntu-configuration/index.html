
<!doctype html>














<html class="theme-next pisces" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/assets/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/assets/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/assets/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="ProxMox,Ubuntu,远程桌面,内网穿透," />





  <link rel="alternate" href="/atom.xml" title="Streamelody" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico?v=5.1.1" />
















<meta name="description" content="ProxMox VE 相关配置 # 配置分辨率 # 在 /etc/pve/qemu-server/xxx.conf 最后加入以下代码 vga: vmware # ISO 镜像上传目录 /var/lib/vz/template/iso # 备份目录 /var/lib/vz/dump">
<meta name="keywords" content="ProxMox, Ubuntu, 远程桌面, 内网穿透">
<meta property="og:type" content="article">
<meta property="og:title" content="ProxMox 5.4 创建 Ubuntu 虚拟机">
<meta property="og:url" content="http://localhost:4000/2019/06/proxmox-ubuntu-configuration/">
<meta property="og:site_name" content="Streamelody">
<meta property="og:description" content="ProxMox VE 相关配置 # 配置分辨率 # 在 /etc/pve/qemu-server/xxx.conf 最后加入以下代码 vga: vmware # ISO 镜像上传目录 /var/lib/vz/template/iso # 备份目录 /var/lib/vz/dump">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ProxMox 5.4 创建 Ubuntu 虚拟机">
<meta name="twitter:description" content="ProxMox VE 相关配置 # 配置分辨率 # 在 /etc/pve/qemu-server/xxx.conf 最后加入以下代码 vga: vmware # ISO 镜像上传目录 /var/lib/vz/template/iso # 备份目录 /var/lib/vz/dump">


<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: false,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://localhost:4000/"/>





  <title>ProxMox 5.4 创建 Ubuntu 虚拟机 | Streamelody</title>
  
















</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Streamelody</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">Days in a Green Hill</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

<div id="posts" class="posts-expand">
  
  

  

  
  
  

  <article class="post post-type- " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/2019/06/proxmox-ubuntu-configuration/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小溪之歌">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/assets/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Streamelody">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
          
          
            ProxMox 5.4 创建 Ubuntu 虚拟机
          
        </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-07T11:35:16+08:00">
                2019-06-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/category/#/%E5%8D%9A%E5%AE%A2" itemprop="url" rel="index">
                    <span itemprop="name">博客</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/category/#/%E9%9A%8F%E7%AC%94" itemprop="url" rel="index">
                    <span itemprop="name">随笔</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          
            
                <div class="post-description">
                    
                </div>
            
          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
  
  












  <h1 id="proxmox-ve-相关配置">ProxMox VE 相关配置</h1>

<div class="language-shell highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9</pre></td><td class="code"><pre class="highlight"><code><span class="c"># 配置分辨率</span>
<span class="c"># 在 /etc/pve/qemu-server/xxx.conf 最后加入以下代码</span>
vga: vmware

<span class="c"># ISO 镜像上传目录</span>
/var/lib/vz/template/iso

<span class="c"># 备份目录</span>
/var/lib/vz/dump
</code></pre></td></tr></tbody></table></div></div>

<!--more-->

<h1 id="配置-frp-客户端">配置 FRP 客户端</h1>

<div class="language-shell highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42<br/>43<br/>44<br/>45<br/>46<br/>47<br/>48<br/>49<br/>50<br/>51<br/>52<br/>53<br/>54<br/>55<br/>56<br/>57<br/>58<br/>59<br/>60<br/>61<br/>62<br/>63<br/>64<br/>65<br/>66<br/>67<br/>68<br/>69<br/>70<br/>71<br/>72<br/>73</pre></td><td class="code"><pre class="highlight"><code><span class="c"># 直接在 ProxMox VE 的 Shell 下配置</span>
<span class="c"># 下载 64 位 Linux 版 frp</span>
wget https://github.com/fatedier/frp/releases/download/v0.27.0/frp_0.27.0_linux_amd64.tar.gz
<span class="c"># 解压</span>
<span class="nb">tar</span> <span class="nt">-zxvf</span> frp_0.27.0_linux_amd64.tar.gz
<span class="c"># 赋予权限</span>
<span class="nb">cd </span>frp_0.27.0_linux_amd64
<span class="nb">chmod</span> +x frpc
<span class="c"># 将 frpc 放到 /usr/bin/ 目录下</span>
<span class="nb">cp </span>frpc /usr/bin/
<span class="c"># 将配置文件复制到对应的配置文件目录</span>
<span class="nb">mkdir</span> /etc/frp/
<span class="nb">cp </span>frpc.ini /etc/frp/

<span class="c"># frpc.ini 配置示例，这里兼容 N1 小钢炮 FRP 的设置</span>
<span class="c"># frps.ini 服务端配置参考这里：https://streamelody.github.io/2019/04/n1-disk-mangaer-frp-update/</span>
<span class="o">[</span>common]
server_addr <span class="o">=</span> 服务端 IP 地址
server_port <span class="o">=</span> 7000
log_file <span class="o">=</span> /var/log/frpc.log
log_level <span class="o">=</span> info
log_max_days <span class="o">=</span> 3
token <span class="o">=</span> 12345678
admin_addr <span class="o">=</span> 127.0.0.1
admin_port <span class="o">=</span> 7400
admin_user <span class="o">=</span> admin
admin_passwd <span class="o">=</span> admin
pool_count <span class="o">=</span> 5
tcp_mux <span class="o">=</span> <span class="nb">true
</span>login_fail_exit <span class="o">=</span> <span class="nb">false
</span>protocol <span class="o">=</span> tcp
heartbeat_interval <span class="o">=</span> 10
heartbeat_timeout <span class="o">=</span> 90

<span class="o">[</span>ssh]
<span class="nb">type</span> <span class="o">=</span> tcp
local_ip <span class="o">=</span> 192.168.2.117
local_port <span class="o">=</span> 22
remote_port <span class="o">=</span> 6000

<span class="o">[</span>pve]
<span class="nb">type</span> <span class="o">=</span> https
local_ip <span class="o">=</span> 192.168.2.117
local_port <span class="o">=</span> 8006
use_encryption <span class="o">=</span> <span class="nb">true
</span>use_compression <span class="o">=</span> <span class="nb">true
</span>subdomain <span class="o">=</span> pve

<span class="c"># 使用 systemd 配置开机自启</span>
vi /etc/systemd/system/frpc.service
<span class="c"># 以下是配置文件</span>
<span class="o">[</span>Unit]
<span class="nv">Description</span><span class="o">=</span>FRP Client Daemon
<span class="nv">After</span><span class="o">=</span>network.target
<span class="nv">Wants</span><span class="o">=</span>network.target

<span class="o">[</span>Service]
<span class="nv">Type</span><span class="o">=</span>simple
<span class="nv">ExecStart</span><span class="o">=</span>/usr/bin/frpc <span class="nt">-c</span> /etc/frp/frpc.ini
<span class="nv">Restart</span><span class="o">=</span>always
<span class="nv">RestartSec</span><span class="o">=</span>20s
<span class="nv">User</span><span class="o">=</span>nobody

<span class="o">[</span>Install]
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target

<span class="c"># 开机启动 frp 客户端</span>
systemctl <span class="nb">enable </span>frpc

<span class="c"># 重启和查看 frp 客户端状态</span>
systemctl restart frpc
systemctl status frpc
ps <span class="nt">-e</span> | <span class="nb">grep </span>frpc
</code></pre></td></tr></tbody></table></div></div>

<h1 id="ubuntu-虚拟机配置">Ubuntu 虚拟机配置</h1>

<div class="language-shell highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42</pre></td><td class="code"><pre class="highlight"><code><span class="c"># 参考这篇文章可以安装 Ubuntu</span>
<span class="c"># https://www.kclouder.cn/proxmox-ve-installation/</span>

<span class="c"># ISO 镜像必须通过 Web 控制台上传，以下为其位置</span>
/var/lib/vz/template/iso

<span class="c">#备份目录一般在 </span>
/var/lib/vz/dump

<span class="c"># 创建虚拟机时，硬盘选 SATA，网络选 Intel E1000</span>
<span class="c"># 查看文件大小</span>
<span class="nb">ls</span> <span class="nt">-lht</span>

<span class="c"># 默认是没有安装 SSH Server</span>
<span class="nb">sudo </span>apt-get <span class="nb">install </span>openssh-server  
ps <span class="nt">-e</span> | <span class="nb">grep </span>ssh

<span class="c"># 开启桌面共享</span>
<span class="nb">sudo </span>apt <span class="nb">install </span>vino
<span class="c"># 在终端执行，"your_password"修改为自己的密码</span>
<span class="nb">export </span><span class="nv">DISPLAY</span><span class="o">=</span><span class="s2">":0"</span>
gsettings <span class="nb">set </span>org.gnome.Vino require-encryption <span class="nb">false
</span>gsettings <span class="nb">set </span>org.gnome.Vino prompt-enabled <span class="nb">false
</span>gsettings <span class="nb">set </span>org.gnome.Vino authentication-methods <span class="s2">"['vnc']"</span>
gsettings <span class="nb">set </span>org.gnome.Vino vnc-password <span class="s2">"</span><span class="si">$(</span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"your_password"</span> | <span class="nb">base64</span><span class="si">)</span><span class="s2">"</span>

<span class="c"># 配置开机自启</span>
<span class="nb">sudo </span>vi /etc/xdg/autostart/vino-server.desktop
<span class="c"># 以下是配置文件</span>
<span class="o">[</span>Desktop Entry]
<span class="nv">Name</span><span class="o">=</span>Desktop Sharing
<span class="nv">Comment</span><span class="o">=</span>GNOME Desktop Sharing Server
<span class="nv">Keywords</span><span class="o">=</span>vnc<span class="p">;</span>share<span class="p">;</span>remote<span class="p">;</span>
<span class="nv">NoDisplay</span><span class="o">=</span><span class="nb">true
</span><span class="nv">Exec</span><span class="o">=</span>/usr/lib/vino/vino-server <span class="nt">--sm-disable</span>
<span class="nv">Icon</span><span class="o">=</span>preferences-desktop-remote-desktop
<span class="nv">Terminal</span><span class="o">=</span><span class="nb">false
</span><span class="nv">Type</span><span class="o">=</span>Application
X-GNOME-Autostart-Phase<span class="o">=</span>Applications
X-GNOME-AutoRestart<span class="o">=</span><span class="nb">true
</span>X-GNOME-UsesNotifications<span class="o">=</span><span class="nb">true
</span>X-Ubuntu-Gettext-Domain<span class="o">=</span>vino
</code></pre></td></tr></tbody></table></div></div>

<h1 id="ubuntu-安装-docker">Ubuntu 安装 Docker</h1>

<div class="language-shell highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20</pre></td><td class="code"><pre class="highlight"><code><span class="c"># 解决依赖</span>
<span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="se">\</span>
    apt-transport-https <span class="se">\</span>
    ca-certificates <span class="se">\</span>
    curl <span class="se">\</span>
    gnupg2 <span class="se">\</span>
    software-properties-common
    
<span class="c"># 安装 GPG Key</span>
curl <span class="nt">-fsSL</span> https://download.docker.com/linux/ubuntu/gpg | <span class="nb">sudo </span>apt-key add -
   
<span class="c"># 安装 Docker    </span>
<span class="nb">sudo </span>apt-get update
<span class="nb">sudo </span>apt <span class="nb">install </span>docker.io

<span class="c"># 将当前用户加入 Docker 用户组，退出用户，重新登录（关键）。</span>
<span class="nb">sudo </span>usermod <span class="nt">-aG</span> docker <span class="k">${</span><span class="nv">USER</span><span class="k">}</span>

<span class="c"># 测试</span>
docker <span class="nt">--version</span>
</code></pre></td></tr></tbody></table></div></div>

<h1 id="启用嵌套虚拟化">启用嵌套虚拟化</h1>

<div class="language-shell highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28</pre></td><td class="code"><pre class="highlight"><code><span class="c"># SSH 进入 ProxMox，查看是否开启嵌套虚拟化，显示 “N” 表示没有开启</span>
<span class="nb">cat</span> /sys/module/kvm_intel/parameters/nested

<span class="c"># 首先关闭所有虚拟机</span>
qm list
qm stop &lt;vm_id&gt;

<span class="c"># 开启内核支持，开启之前确保所有的虚拟机已经关闭</span>
modprobe <span class="nt">-r</span> kvm_intel  
modprobe kvm_intel <span class="nv">nested</span><span class="o">=</span>1

<span class="c"># 再次查看是否已经开启，显示 “Y” 表示已经开启</span>
<span class="nb">cat</span> /sys/module/kvm_intel/parameters/nested

<span class="c"># 编辑配置文件，重启能够自动加载</span>
<span class="nb">echo</span> <span class="s2">"options kvm_intel nested=1"</span> <span class="o">&gt;&gt;</span> /etc/modprobe.d/modprobe.conf

<span class="c"># 在 /etc/pve/qemu-server/ 下的配置文件添加命令</span>
args: <span class="nt">-cpu</span> +vmx

<span class="c"># 启动 macOS Mojave 虚拟机，执行以下命令</span>
sysctl <span class="nt">-a</span> | <span class="nb">grep </span>machdep.cpu.features

<span class="c"># Linux 执行以下命令</span>
egrep <span class="s2">"vmx|svm"</span> /proc/cpuinfo 

<span class="c"># 得到结果，当结果包含 VMX 时，表示已经成功开启嵌套虚拟化</span>
machdep.cpu.features: FPU VME DE PSE TSC MSR PAE MCE CX8 APIC SEP MTRR PGE MCA CMOV PAT PSE36 CLFSH MMX FXSR SSE SSE2 HTT SSE3 VMX SSSE3 CX16 SSE4.1 SSE4.2 x2APIC POPCNT AES VMM PCID XSAVE
</code></pre></td></tr></tbody></table></div></div>

<h1 id="开机自动挂载-nfs">开机自动挂载 NFS</h1>

<div class="language-shell highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17</pre></td><td class="code"><pre class="highlight"><code><span class="c"># 安装 nfs-common</span>
<span class="nb">sudo </span>apt-get <span class="nb">install </span>nfs-common

<span class="c"># 查看共享的目录</span>
showmount <span class="nt">-e</span> 192.168.2.109

<span class="c"># 创建本地的挂载目录</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> /mnt/Downloads

<span class="c"># 挂载命令</span>
mount 192.168.2.109:/Volumes/Downloads /mnt/Downloads

<span class="c"># 开机自动挂载</span>
<span class="nb">sudo </span>vim /etc/fstab
192.168.2.109:/Volumes/Downloads /mnt/Downloads nfs defaults 0 2
<span class="c"># 第一个数字：0 表示开机不检查磁盘，1 表示开机检查磁盘。</span>
<span class="c"># 第二个数字：0 表示交换分区，1 代表启动分区（Linux），2 表示普通分区。</span>
</code></pre></td></tr></tbody></table></div></div>

<h1 id="ubuntu-vps-搭建-gnome-桌面以及使用-vnc-连接">Ubuntu VPS 搭建 Gnome 桌面以及使用 VNC 连接</h1>

<div class="language-shell highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42<br/>43<br/>44<br/>45<br/>46<br/>47<br/>48<br/>49<br/>50<br/>51<br/>52<br/>53<br/>54<br/>55<br/>56<br/>57</pre></td><td class="code"><pre class="highlight"><code><span class="c"># 搭建 Gnome 桌面</span>

<span class="c"># 使用 SSH 登录服务器</span>
<span class="c"># 更新源及系统</span>
apt-get update
apt upgrade <span class="nt">-y</span>

<span class="c"># 安装桌面环境，完整版(不推荐)</span>
apt-get <span class="nb">install </span>ubuntu-desktop gnome-panel gnome-settings-daemon metacity nautilus gnome-terminal

<span class="c"># 安装桌面环境核心组件，不安装如 office 等额外组件</span>
apt-get <span class="nb">install</span> <span class="nt">--no-install-recommends</span> ubuntu-desktop gnome-panel gnome-settings-daemon metacity nautilus gnome-terminal <span class="nt">-y</span>

<span class="c"># 安装 vnc4server</span>
apt-get <span class="nb">install </span>vnc4server

<span class="c"># 设置当前用户 vnc 密码</span>
vncpasswd

<span class="c"># 启动 vncserver，之前没有设置密码这里会要求设置密码</span>
<span class="c"># ":1" 代表 display 号，vncserver 的端口号为 5900 + display 号，这里为 5901</span>
vncserver :1

<span class="c"># 结束 vncserver</span>
vncserver <span class="nt">-kill</span> :1

<span class="c"># 修改配置文件 xstartup</span>
vim ~/.vnc/xstartup

<span class="c"># 这里是 xstartup 配置文件内容</span>
<span class="c">#!/bin/sh</span>

<span class="nb">export </span><span class="nv">XKL_XMODMAP_DISABLE</span><span class="o">=</span>1
<span class="nb">unset </span>SESSION_MANAGER
<span class="nb">unset </span>DBUS_SESSION_BUS_ADDRESS

gnome-panel &amp;
gnmoe-settings-daemon &amp;
metacity &amp;
nautilus &amp;
gnome-terminal &amp;

<span class="c"># 重新赋予一下权限</span>
<span class="nb">chmod </span>777 ~/.vnc/xstartup

<span class="c"># 重新启动 vncserver</span>
vncserver :1

<span class="c"># 配置开机启动</span>
<span class="c"># 打开crontab任务</span>
crontab <span class="nt">-e</span>

<span class="c"># 另起一行，输入以下命令</span>
@reboot /usr/bin/vncserver :1

<span class="c"># 使用 VNC 连接</span>
vnc://server_ip_address:5901
</code></pre></td></tr></tbody></table></div></div>

<h1 id="debain-vps-搭建-xfce-桌面以及使用-vnc-连接">Debain VPS 搭建 xfce 桌面以及使用 VNC 连接</h1>

<div class="language-shell highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13<br/>14<br/>15<br/>16<br/>17<br/>18<br/>19<br/>20<br/>21<br/>22<br/>23<br/>24<br/>25<br/>26<br/>27<br/>28<br/>29<br/>30<br/>31<br/>32<br/>33<br/>34<br/>35<br/>36<br/>37<br/>38<br/>39<br/>40<br/>41<br/>42<br/>43<br/>44<br/>45<br/>46<br/>47<br/>48<br/>49<br/>50<br/>51<br/>52<br/>53<br/>54<br/>55<br/>56<br/>57<br/>58<br/>59<br/>60<br/>61<br/>62<br/>63<br/>64<br/>65<br/>66<br/>67<br/>68<br/>69</pre></td><td class="code"><pre class="highlight"><code><span class="c"># 使用 SSH 登录服务器</span>
<span class="c"># 更新源及系统</span>
apt-get update
apt upgrade <span class="nt">-y</span>

<span class="c"># 安装桌面环境，完整版</span>
apt <span class="nb">install </span>xfce4 xfce4-goodies

<span class="c"># 安装 TightVNC 服务器</span>
apt <span class="nb">install </span>tightvncserver

<span class="c"># 设置当前用户 vnc 密码</span>
vncserver

<span class="c"># 结束 vncserver</span>
vncserver <span class="nt">-kill</span> :1

<span class="c"># 配置 VNC 服务器</span>
<span class="c"># 备份原始文件</span>
<span class="nb">mv</span> ~/.vnc/xstartup ~/.vnc/xstartup.bak
vim ~/.vnc/xstartup
<span class="c"># 这里是 xstartup 配置文件内容</span>
<span class="c">#!/bin/bash</span>
xrdb <span class="nv">$HOME</span>/.Xresources
startxfce4 &amp;

<span class="c"># 重新赋予一下权限</span>
<span class="nb">chmod</span> +x ~/.vnc/xstartup

<span class="c"># 重新启动 vncserver</span>
vncserver

<span class="c"># 获取当前用户</span>
<span class="nb">whoami</span>
<span class="c"># 获取当前组</span>
<span class="nb">groups</span>

<span class="c"># 将 VNC 作为系统服务运行</span>
vim /etc/systemd/system/vncserver@.service

<span class="c"># 以下为 vncserver@.service 配置文件</span>
<span class="o">[</span>Unit]
<span class="nv">Description</span><span class="o">=</span>Start TightVNC server at startup
<span class="nv">After</span><span class="o">=</span>syslog.target network.target

<span class="o">[</span>Service]
<span class="nv">Type</span><span class="o">=</span>forking
<span class="nv">User</span><span class="o">=</span>root
<span class="nv">Group</span><span class="o">=</span>root
<span class="nv">WorkingDirectory</span><span class="o">=</span>/root

<span class="nv">PIDFile</span><span class="o">=</span>/root/.vnc/%H:%i.pid
<span class="nv">ExecStartPre</span><span class="o">=</span>-/usr/bin/vncserver <span class="nt">-kill</span> :%i <span class="o">&gt;</span> /dev/null 2&gt;&amp;1
<span class="nv">ExecStart</span><span class="o">=</span>/usr/bin/vncserver <span class="nt">-depth</span> 24 <span class="nt">-geometry</span> 1280x800 :%i
<span class="nv">ExecStop</span><span class="o">=</span>/usr/bin/vncserver <span class="nt">-kill</span> :%i

<span class="o">[</span>Install]
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target

<span class="c"># 启用单元文件</span>
systemctl daemon-reload
systemctl <span class="nb">enable </span>vncserver@1.service

<span class="c"># 重启 vncserver</span>
vncserver <span class="nt">-kill</span> :1
systemctl start vncserver@1

<span class="c"># 验证 vncserver 状态</span>
systemctl status vncserver@1
</code></pre></td></tr></tbody></table></div></div>

<h1 id="参考文章">参考文章</h1>

<ol>
  <li><a href="https://www.kclouder.cn/proxmox-ve-installation/">Proxmox VE 安装介绍</a></li>
  <li><a href="https://blog.csdn.net/Fate10_55/article/details/78182799Proxmox">Proxmox环境下 Ubuntu16.04 + CUDA 8.0 GA2 安装</a></li>
  <li><a href="https://blog.csdn.net/Fate10_55/article/details/78194817">Proxmox + Ubuntu16.04 + CUDA 8.0 环境下，安装Tensorflow</a></li>
  <li><a href="https://www.reddit.com/r/linuxmint/comments/9ilpkx/mint_19_cinnamon_remote_access_vnc/">Mint 19 Cinnamon / Remote Access</a></li>
  <li><a href="https://zocodev.com/debian9-frp-internal-network-penetration.html">Debian9系统使用FRP内网穿透</a></li>
  <li><a href="https://it.ismy.fun/2019/01/18/linuxmint-install-docker/">Linux Mint 19 Tara 安装 Docker CE</a></li>
  <li><a href="https://my.oschina.net/u/1440971/blog/2996084">ubuntu 18.04 安装NFS 共享文件夹,Linux挂载，Mac 挂载</a></li>
  <li><a href="https://blog.csdn.net/wwq_1111/article/details/46502873">Ubuntu14.04使用VNC无法显示图形界面问题的解决</a></li>
  <li><a href="https://blog.csdn.net/u014389734/article/details/79513517">Ubuntu16.04 用VNC链接 GNOME 桌面</a></li>
</ol>


      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            
            <a href="/tag/#/ProxMox" rel="tag"># ProxMox</a>
          
            
            <a href="/tag/#/Ubuntu" rel="tag"># Ubuntu</a>
          
            
            <a href="/tag/#/%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2" rel="tag"># 远程桌面</a>
          
            
            <a href="/tag/#/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F" rel="tag"># 内网穿透</a>
          
        </div>
      

      
      
      
      
      

      
      
        <div class="post-nav" id="post-nav-id">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/06/proxmox-macos-mojave/" rel="next" title="ProxMox 5.4 安装 macOS Mojave">
                <i class="fa fa-chevron-left"></i> ProxMox 5.4 安装 macOS Mojave
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/05/navicat-database-import/" rel="prev" title="使用 Navicat 将 SQL Server 迁移到 MySQL">
                使用 Navicat 将 SQL Server 迁移到 MySQL <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      
      

      
    </footer>
  </article>

  <div class="post-spread">
    
  </div>
</div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          

  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        
        
        







      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/assets/images/avatar.gif"
               alt="小溪之歌" />
          <p class="site-author-name" itemprop="name">小溪之歌</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">93</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/">
                <span class="site-state-item-count">99</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
        
        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              
              
              <span class="links-of-author-item">
                <a href="https://github.com/streamelody" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              
              
              <span class="links-of-author-item">
                <a href="shuangyeying@gmail.com" target="_blank" title="Email">
                  
                    <i class="fa fa-fw fa-envelope-o"></i>
                  
                  Email
                </a>
              </span>
            
              
              
              <span class="links-of-author-item">
                <a href="https://facebook.com/streamelody" target="_blank" title="Facebook">
                  
                    <i class="fa fa-fw fa-facebook"></i>
                  
                  Facebook
                </a>
              </span>
            
              
              
              <span class="links-of-author-item">
                <a href="http://www.weibo.com/bailuer" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            








            
              <div class="post-toc-content">
    <ol class=nav>
      <li class="nav-item nav-level-1"> <a class="nav-link" href="#proxmox-ve-相关配置"> <span class="nav-number">1</span> <span class="nav-text">ProxMox VE 相关配置</span> </a> </li> <li class="nav-item nav-level-1"> <a class="nav-link" href="#配置-frp-客户端"> <span class="nav-number">2</span> <span class="nav-text">配置 FRP 客户端</span> </a> </li> <li class="nav-item nav-level-1"> <a class="nav-link" href="#ubuntu-虚拟机配置"> <span class="nav-number">3</span> <span class="nav-text">Ubuntu 虚拟机配置</span> </a> </li> <li class="nav-item nav-level-1"> <a class="nav-link" href="#ubuntu-安装-docker"> <span class="nav-number">4</span> <span class="nav-text">Ubuntu 安装 Docker</span> </a> </li> <li class="nav-item nav-level-1"> <a class="nav-link" href="#启用嵌套虚拟化"> <span class="nav-number">5</span> <span class="nav-text">启用嵌套虚拟化</span> </a> </li> <li class="nav-item nav-level-1"> <a class="nav-link" href="#开机自动挂载-nfs"> <span class="nav-number">6</span> <span class="nav-text">开机自动挂载 NFS</span> </a> </li> <li class="nav-item nav-level-1"> <a class="nav-link" href="#ubuntu-vps-搭建-gnome-桌面以及使用-vnc-连接"> <span class="nav-number">7</span> <span class="nav-text">Ubuntu VPS 搭建 Gnome 桌面以及使用 VNC 连接</span> </a> </li> <li class="nav-item nav-level-1"> <a class="nav-link" href="#debain-vps-搭建-xfce-桌面以及使用-vnc-连接"> <span class="nav-number">8</span> <span class="nav-text">Debain VPS 搭建 xfce 桌面以及使用 VNC 连接</span> </a> </li> <li class="nav-item nav-level-1"> <a class="nav-link" href="#参考文章"> <span class="nav-number">9</span> <span class="nav-text">参考文章</span> </a> </li>
    </ol>
  </div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>

        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  
  &copy;  2010 - 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">小溪之歌</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://jekyllrb.com">Jekyll</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/simpleyyt/jekyll-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>





















  
   
  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/jquery/index.js?v=2.1.3"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/assets/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/assets/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/assets/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/assets/js/src/schemes/pisces.js?v=5.1.1"></script>



  <script type="text/javascript" src="/assets/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/assets/js/src/post-details.js?v=5.1.1"></script>


  


  <script type="text/javascript" src="/assets/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  











  




  

    

  





  


  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  


  

  

  

</body>
</html>

